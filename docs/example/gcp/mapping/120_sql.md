# GCP Cloud SQL mapping

This document describes the Cloud SQL Instance mapping used to convert Pub/Sub events into a normalized asset event.

Purpose

- Normalize Cloud SQL instance resources emitted by the Pub/Sub source.
- Prepare a compact asset object with a consistent shape for downstream processing or sinks.

Mapped fields

- backendType: the backend generation (for example, SECOND_GEN)
- databaseInstalledVersion: the installed database patch/version
- databaseVersion: the major database version (for example, POSTGRES_17)
- gceZone: the zone where the instance's primary is located
- ipAddresses: list of IP addresses associated with the instance
- kind: resource kind (for example, sql#instance)
- name (PK?): instance name
- region: region where the instance runs
- settings.backupConfiguration.*: backup configuration details (such as retainedBackups, retentionUnit, backupTier, enabled, startTime, transactionLogRetentionDays)
- settings.dataDiskSizeGb: data disk size in GB
- settings.dataDiskType: data disk type (for example PD_HDD)
- settings.deletionProtectionEnabled: whether deletion protection is enabled
- settings.edition: edition string (Possible values can be EDITION_UNSPECIFIED, ENTERPRISE, ENTERPRISE_PLUS)
- settings.enableGoogleMlIntegration: whether ML integration is enabled
- settings.finalBackupConfig.enabled: whether final backup at deletion is enabled
- settings.locationPreference.zone: preferred zone for the instance
- settings.storageAutoResize: whether storage auto resize is enabled
- settings.storageAutoResizeLimit: maximum size limit for auto-resize
- settings.userLabels: user-defined labels attached to the instance
- state: instance state (for example RUNNABLE)
- updateTime: RFC 3339 timestamp for last update
- location: the region where the instance is deployed

```json
{
  "type": "sqladmin.googleapis.com/Instance",
  "syncable": true,
  "apiVersion": "sqlinstances.sql.gcp.mia-platform.eu/v1alpha1",
  "mappings": {
    "identifier": "{{name}}",
    "specs": {
      "backendType": "{{resource.data.backendType}}",
      "databaseInstalledVersion": "{{resource.data.databaseInstalledVersion}}",
      "databaseVersion": "{{resource.data.databaseVersion}}",
      "gceZone": "{{resource.data.gceZone}}",
      "ipAddresses": "{{resource.data.ipAddresses}}",
      "kind": "{{resource.data.kind}}",
      "region": "{{resource.data.region}}",
      "backupConfiguration": "{{ .resource.data.settings.backupConfiguration | toJSON}}",
      "dataDiskSizeGb": "{{resource.data.settings.dataDiskSizeGb}}",
      "dataDiskType": "{{resource.data.settings.dataDiskType}}",
      "deletionProtectionEnabled": "{{resource.data.settings.deletionProtectionEnabled}}",
      "edition": "{{resource.data.settings.edition}}",
      "enableGoogleMlIntegration": "{{resource.data.settings.enableGoogleMlIntegration}}",
      "finalBackupConfig": "{{ .resource.data.settings.finalBackupConfig | toJSON}}",
      "locationPreference": "{{ .resource.data.settings.locationPreference | toJSON}}",
      "storageAutoResize": "{{resource.data.settings.storageAutoResize}}",
      "storageAutoResizeLimit": "{{resource.data.settings.storageAutoResizeLimit}}",
      "userLabels": "{{ .resource.data.settings.userLabels | toJSON}}",
      "state": "{{resource.data.state}}",
      "updateTime": "{{updateTime}}",
      "location": "{{resource.location}}"
    }
  }
}
```

## Data Example JSON representation

```json
{
  "type": "sqladmin.googleapis.com/Instance",
  "syncable": true,
  "apiVersion": "sqlinstances.sql.gcp.mia-platform.eu/v1alpha1",
  "mappings": {
    "identifier": "my-pgsql-low",
    "specs": {
      "backendType": "SECOND_GEN",
      "databaseInstalledVersion": "POSTGRES_17_6",
      "databaseVersion": "POSTGRES_17",
      "gceZone": "europe-west1-d",
      "ipAddresses": [
        {
          "ipAddress": "34.14.15.55",
          "type": "PRIMARY"
        },
        {
          "ipAddress": "34.14.81.95",
          "type": "OUTGOING"
        }
      ],
      "kind": "sql#instance",
      "region": "europe-west1",
      "settings": {
        "backupConfiguration": {
          "backupRetentionSettings": {
            "retainedBackups": 7,
            "retentionUnit": "COUNT"
          },
          "backupTier": "STANDARD",
          "enabled": false,
          "startTime": "06:00",
          "transactionLogRetentionDays": 7
        },
        "dataDiskSizeGb": "10",
        "dataDiskType": "PD_HDD",
        "deletionProtectionEnabled": false,
        "edition": "ENTERPRISE",
        "enableGoogleMlIntegration": false,
        "finalBackupConfig": {
          "enabled": false
        },
        "locationPreference": {
          "zone": "europe-west1-d"
        },
        "storageAutoResize": false,
        "storageAutoResizeLimit": "0",
        "userLabels": {
          "db-type": "super-pgsql-power"
        }
      },
      "state": "RUNNABLE",
      "updateTime": "2025-10-13T14:04:59.418617Z",
      "location": "europe-west1-d"
    }
  }
}
```
