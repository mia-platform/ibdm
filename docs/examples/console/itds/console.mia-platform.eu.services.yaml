# yaml-language-server: $schema=https://cdn.mia-platform.eu/catalog/v1alpha1/mia-platform.eu.v1alpha1.ItemTypeDefinition.json
---
apiVersion: mia-platform.eu/v1alpha1
kind: ItemTypeDefinition
metadata:
  name: services.console.mia-platform.eu
  description: The configuration of a microservice in the Mia-Platform Console
spec:
  group: console.mia-platform.eu
  names:
    kind: Service
    plural: services
    displayPlural: Services
  scope: Organization
  versions:
    - name: v1alpha1
      served: true
      schema:
        openAPIV31Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                projectUniqueId:
                  title: Console project unique ID
                  description: The unique identifier for the project.
                  type: string
                projectId:
                  title: Console project ID
                  description: The project ID used to identify the project in Console.
                  type: string
                tenantId:
                  title: Console tenant ID
                  description: The tenant ID used to identify the tenant in Console.
                  type: string
                revisionName:
                  title: Console project revision name
                  description: The user visible name for the revision.
                  type: string
                configuration:
                  title: Configuration
                  description: The configuration of the service as defined in the Design area of the Console.
                  type: object
                  properties:
                    name:
                      type: string
                      minLength: 1
                    description:
                      type: string
                    tags:
                      type: array
                      items:
                        type: string
                    type:
                      type: string
                      enum:
                        - custom
                    advanced:
                      type: boolean
                      enum:
                        - false
                    dockerImage:
                      type: string
                    repoUrl:
                      type: string
                    sshUrl:
                      type: string
                    links:
                      type: array
                      items:
                        type: object
                        properties:
                          label:
                            type: string
                          enableIf:
                            type: string
                          targetSection:
                            type: string
                          hidePrefix:
                            type: boolean
                    dockerImagePullSecrets:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                        required:
                          - name
                    replicas:
                      anyOf:
                        - type: number
                          minimum: 0
                        - type: string
                    serviceAccountName:
                      type: string
                      maxLength: 253
                    productionReplicas:
                      type: object
                      properties:
                        min:
                          type: string
                        max:
                          type: string
                        cpuThreshold:
                          type: string
                        generate:
                          type: boolean
                        deleted:
                          type: boolean
                    logParser:
                      type: string
                    additionalContainers:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                            minLength: 1
                          description:
                            type: string
                          repoUrl:
                            type: string
                          dockerImage:
                            type: string
                          imagePullPolicy:
                            type: string
                          environment:
                            type: array
                            items:
                              oneOf:
                                - type: object
                                  properties:
                                    name:
                                      type: string
                                      minLength: 1
                                    readOnly:
                                      type: boolean
                                    managedBy:
                                      type: string
                                    description:
                                      type: string
                                    valueType:
                                      type: string
                                      enum:
                                        - plain
                                    value:
                                      type: string
                                  required:
                                    - name
                                    - value
                                    - valueType
                                - type: object
                                  properties:
                                    name:
                                      type: string
                                      minLength: 1
                                    readOnly:
                                      type: boolean
                                    managedBy:
                                      type: string
                                    description:
                                      type: string
                                    valueType:
                                      type: string
                                      enum:
                                        - secret
                                    secretName:
                                      type: string
                                    secretKey:
                                      type: string
                                  required:
                                    - name
                                    - secretName
                                    - secretKey
                                    - valueType
                                - type: object
                                  properties:
                                    name:
                                      type: string
                                      minLength: 1
                                    readOnly:
                                      type: boolean
                                    managedBy:
                                      type: string
                                    description:
                                      type: string
                                    valueType:
                                      type: string
                                      enum:
                                        - configmap
                                    configMapName:
                                      type: string
                                    configMapFileName:
                                      type: string
                                  required:
                                    - name
                                    - valueType
                                    - configMapName
                                    - configMapFileName
                                - anyOf:
                                    - type: object
                                      required:
                                        - name
                                        - valueType
                                        - fieldPath
                                        - containerName
                                      properties:
                                        name:
                                          type: string
                                          minLength: 1
                                        readOnly:
                                          type: boolean
                                        managedBy:
                                          type: string
                                        description:
                                          type: string
                                        valueType:
                                          type: string
                                          enum:
                                            - downwardAPI
                                        fieldPath:
                                          type: string
                                          enum:
                                            - resource.limits.cpu
                                            - resource.requests.cpu
                                            - resource.limits.memory
                                            - resource.requests.memory
                                            - resource.limits.ephemeral-storage
                                            - resource.requests.ephemeral-storage
                                        containerName:
                                          type: string
                                    - type: object
                                      required:
                                        - name
                                        - valueType
                                        - fieldPath
                                      properties:
                                        name:
                                          type: string
                                          minLength: 1
                                        readOnly:
                                          type: boolean
                                        managedBy:
                                          type: string
                                        description:
                                          type: string
                                        valueType:
                                          type: string
                                          enum:
                                            - downwardAPI
                                        fieldPath:
                                          oneOf:
                                            - type: string
                                              enum:
                                                - metadata.name
                                                - metadata.namespace
                                                - metadata.uid
                                                - spec.serviceAccountName
                                                - spec.nodeName
                                                - status.hostIP
                                                - status.podIP
                                                - status.podIPs
                                            - type: string
                                            - type: string
                          annotations:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                                description:
                                  type: string
                                readOnly:
                                  type: boolean
                              required:
                                - name
                                - value
                          labels:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                                description:
                                  type: string
                                readOnly:
                                  type: boolean
                                isSelector:
                                  type: boolean
                              required:
                                - name
                                - value
                          resources:
                            type: object
                            properties:
                              cpuLimits:
                                type: object
                                properties:
                                  max:
                                    type: string
                                  min:
                                    type: string
                              memoryLimits:
                                type: object
                                properties:
                                  max:
                                    type: string
                                  min:
                                    type: string
                          probes:
                            type: object
                            properties:
                              liveness:
                                type: object
                                properties:
                                  path:
                                    type: string
                                  port:
                                    type: string
                                  cmd:
                                    type: array
                                    items:
                                      type: string
                                  initialDelaySeconds:
                                    type: number
                                  periodSeconds:
                                    type: number
                                  timeoutSeconds:
                                    type: number
                                  successThreshold:
                                    type: number
                                  failureThreshold:
                                    type: number
                              readiness:
                                type: object
                                properties:
                                  path:
                                    type: string
                                  port:
                                    type: string
                                  cmd:
                                    type: array
                                    items:
                                      type: string
                                  initialDelaySeconds:
                                    type: number
                                  periodSeconds:
                                    type: number
                                  timeoutSeconds:
                                    type: number
                                  successThreshold:
                                    type: number
                                  failureThreshold:
                                    type: number
                              startup:
                                type: object
                                properties:
                                  path:
                                    type: string
                                  port:
                                    type: string
                                  cmd:
                                    type: array
                                    items:
                                      type: string
                                  initialDelaySeconds:
                                    type: number
                                  periodSeconds:
                                    type: number
                                  timeoutSeconds:
                                    type: number
                                  successThreshold:
                                    type: number
                                  failureThreshold:
                                    type: number
                          tags:
                            type: array
                            items:
                              type: string
                          generatedFrom:
                            type: object
                            properties:
                              _id:
                                type: string
                          swaggerPath:
                            type: string
                          sshUrl:
                            type: string
                          configMaps:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                mountPath:
                                  type: string
                                subPaths:
                                  type: array
                                  items:
                                    type: string
                                viewAsReadOnly:
                                  type: boolean
                                link:
                                  type: object
                                  properties:
                                    targetSection:
                                      type: string
                              required:
                                - name
                                - mountPath
                          secrets:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                mountPath:
                                  type: string
                          emptyDirMounts:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                mountPath:
                                  type: string
                          sourceComponentId:
                            type: string
                          sourceMarketplaceItem:
                            type: object
                            properties:
                              itemId:
                                type: string
                              version:
                                type: string
                              tenantId:
                                type: string
                              detached:
                                type: boolean
                            required:
                              - itemId
                              - version
                              - tenantId
                          mapEnvVarToMountPath:
                            type: object
                            additionalProperties:
                              type: object
                              required:
                                - type
                                - envName
                              properties:
                                type:
                                  type: string
                                  enum:
                                    - file
                                    - folder
                                envName:
                                  type: string
                          links:
                            type: array
                            items:
                              type: object
                              properties:
                                label:
                                  type: string
                                enableIf:
                                  type: string
                                targetSection:
                                  type: string
                                hidePrefix:
                                  type: boolean
                          createdAt:
                            type: string
                          owners:
                            type: array
                            items:
                              type: object
                              required:
                                - owner
                              additionalProperties: true
                              properties:
                                owner:
                                  type: string
                          containerPorts:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                from:
                                  anyOf:
                                    - type: integer
                                      minimum: 0
                                      maximum: 65535
                                    - type: string
                                to:
                                  anyOf:
                                    - type: integer
                                      minimum: 0
                                      maximum: 65535
                                    - type: string
                                protocol:
                                  type: string
                              required:
                                - name
                                - from
                          monitoring:
                            type: object
                            properties:
                              endpoints:
                                type: array
                                items:
                                  type: object
                                  properties:
                                    path:
                                      type: string
                                    port:
                                      type: string
                                    interval:
                                      type: string
                                  required:
                                    - interval
                                    - port
                                    - path
                              deleted:
                                type: boolean
                          execPreStop:
                            type: array
                            items:
                              type: string
                          args:
                            type: array
                            items:
                              type: string
                          terminationGracePeriodSeconds:
                            type: number
                          exclusiveServiceExposure:
                            type: boolean
                          containerRegistryId:
                            type: string
                        required:
                          - name
                          - dockerImage
                    emptyDirs:
                      type: object
                      additionalProperties:
                        type: object
                        required:
                          - type
                        properties:
                          type:
                            type: string
                            enum:
                              - default
                              - memory
                          size:
                            type: string
                    imagePullPolicy:
                      type: string
                    environment:
                      type: array
                      items:
                        oneOf:
                          - type: object
                            properties:
                              name:
                                type: string
                                minLength: 1
                              readOnly:
                                type: boolean
                              managedBy:
                                type: string
                              description:
                                type: string
                              valueType:
                                type: string
                                enum:
                                  - plain
                              value:
                                type: string
                            required:
                              - name
                              - value
                              - valueType
                          - type: object
                            properties:
                              name:
                                type: string
                                minLength: 1
                              readOnly:
                                type: boolean
                              managedBy:
                                type: string
                              description:
                                type: string
                              valueType:
                                type: string
                                enum:
                                  - secret
                              secretName:
                                type: string
                              secretKey:
                                type: string
                            required:
                              - name
                              - secretName
                              - secretKey
                              - valueType
                          - type: object
                            properties:
                              name:
                                type: string
                                minLength: 1
                              readOnly:
                                type: boolean
                              managedBy:
                                type: string
                              description:
                                type: string
                              valueType:
                                type: string
                                enum:
                                  - configmap
                              configMapName:
                                type: string
                              configMapFileName:
                                type: string
                            required:
                              - name
                              - valueType
                              - configMapName
                              - configMapFileName
                          - anyOf:
                              - type: object
                                required:
                                  - name
                                  - valueType
                                  - fieldPath
                                  - containerName
                                properties:
                                  name:
                                    type: string
                                    minLength: 1
                                  readOnly:
                                    type: boolean
                                  managedBy:
                                    type: string
                                  description:
                                    type: string
                                  valueType:
                                    type: string
                                    enum:
                                      - downwardAPI
                                  fieldPath:
                                    type: string
                                    enum:
                                      - resource.limits.cpu
                                      - resource.requests.cpu
                                      - resource.limits.memory
                                      - resource.requests.memory
                                      - resource.limits.ephemeral-storage
                                      - resource.requests.ephemeral-storage
                                  containerName:
                                    type: string
                              - type: object
                                required:
                                  - name
                                  - valueType
                                  - fieldPath
                                properties:
                                  name:
                                    type: string
                                    minLength: 1
                                  readOnly:
                                    type: boolean
                                  managedBy:
                                    type: string
                                  description:
                                    type: string
                                  valueType:
                                    type: string
                                    enum:
                                      - downwardAPI
                                  fieldPath:
                                    oneOf:
                                      - type: string
                                        enum:
                                          - metadata.name
                                          - metadata.namespace
                                          - metadata.uid
                                          - spec.serviceAccountName
                                          - spec.nodeName
                                          - status.hostIP
                                          - status.podIP
                                          - status.podIPs
                                      - type: string
                                      - type: string
                    annotations:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          value:
                            type: string
                          description:
                            type: string
                          readOnly:
                            type: boolean
                        required:
                          - name
                          - value
                    labels:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          value:
                            type: string
                          description:
                            type: string
                          readOnly:
                            type: boolean
                          isSelector:
                            type: boolean
                        required:
                          - name
                          - value
                    resources:
                      type: object
                      properties:
                        cpuLimits:
                          type: object
                          properties:
                            max:
                              type: string
                            min:
                              type: string
                        memoryLimits:
                          type: object
                          properties:
                            max:
                              type: string
                            min:
                              type: string
                    probes:
                      type: object
                      properties:
                        liveness:
                          type: object
                          properties:
                            path:
                              type: string
                            port:
                              type: string
                            cmd:
                              type: array
                              items:
                                type: string
                            initialDelaySeconds:
                              type: number
                            periodSeconds:
                              type: number
                            timeoutSeconds:
                              type: number
                            successThreshold:
                              type: number
                            failureThreshold:
                              type: number
                        readiness:
                          type: object
                          properties:
                            path:
                              type: string
                            port:
                              type: string
                            cmd:
                              type: array
                              items:
                                type: string
                            initialDelaySeconds:
                              type: number
                            periodSeconds:
                              type: number
                            timeoutSeconds:
                              type: number
                            successThreshold:
                              type: number
                            failureThreshold:
                              type: number
                        startup:
                          type: object
                          properties:
                            path:
                              type: string
                            port:
                              type: string
                            cmd:
                              type: array
                              items:
                                type: string
                            initialDelaySeconds:
                              type: number
                            periodSeconds:
                              type: number
                            timeoutSeconds:
                              type: number
                            successThreshold:
                              type: number
                            failureThreshold:
                              type: number
                    generatedFrom:
                      type: object
                      properties:
                        _id:
                          type: string
                    swaggerPath:
                      type: string
                    configMaps:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          mountPath:
                            type: string
                          subPaths:
                            type: array
                            items:
                              type: string
                          viewAsReadOnly:
                            type: boolean
                          link:
                            type: object
                            properties:
                              targetSection:
                                type: string
                        required:
                          - name
                          - mountPath
                    secrets:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          mountPath:
                            type: string
                    emptyDirMounts:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          mountPath:
                            type: string
                    sourceComponentId:
                      type: string
                    sourceMarketplaceItem:
                      type: object
                      properties:
                        itemId:
                          type: string
                        version:
                          type: string
                        tenantId:
                          type: string
                        detached:
                          type: boolean
                      required:
                        - itemId
                        - version
                        - tenantId
                    mapEnvVarToMountPath:
                      type: object
                      additionalProperties:
                        type: object
                        required:
                          - type
                          - envName
                        properties:
                          type:
                            type: string
                            enum:
                              - file
                              - folder
                          envName:
                            type: string
                    createdAt:
                      type: string
                    owners:
                      type: array
                      items:
                        type: object
                        required:
                          - owner
                        additionalProperties: true
                        properties:
                          owner:
                            type: string
                    containerPorts:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          from:
                            anyOf:
                              - type: integer
                                minimum: 0
                                maximum: 65535
                              - type: string
                          to:
                            anyOf:
                              - type: integer
                                minimum: 0
                                maximum: 65535
                              - type: string
                          protocol:
                            type: string
                        required:
                          - name
                          - from
                    monitoring:
                      type: object
                      properties:
                        endpoints:
                          type: array
                          items:
                            type: object
                            properties:
                              path:
                                type: string
                              port:
                                type: string
                              interval:
                                type: string
                            required:
                              - interval
                              - port
                              - path
                        deleted:
                          type: boolean
                    execPreStop:
                      type: array
                      items:
                        type: string
                    args:
                      type: array
                      items:
                        type: string
                    terminationGracePeriodSeconds:
                      type: number
                    exclusiveServiceExposure:
                      type: boolean
                    containerRegistryId:
                      type: string
                  required:
                    - name
                    - advanced
                    - type
                    - dockerImage
      selectableFields:
        - jsonPath: spec.projectUniqueId
        - jsonPath: spec.projectId
        - jsonPath: spec.tenantId
        - jsonPath: spec.revisionName
        - jsonPath: spec.configuration.name
        - jsonPath: spec.configuration.dockerImage
